# Agentic RAG æ™ºèƒ½æ£€ç´¢å¢å¼ºç”Ÿæˆç³»ç»Ÿ

åŸºäºå¤šAgentæ¶æ„çš„æ™ºèƒ½RAGç³»ç»Ÿï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢åˆ†è§£ã€å¤šå·¥å…·åä½œå’Œæ™ºèƒ½è·¯ç”±ã€‚é‡‡ç”¨ LlamaIndex.TS + Qdrant Cloud + OpenAI æŠ€æœ¯æ ˆï¼Œæä¾›è‡ªç„¶è¯­è¨€æŸ¥è¯¢ã€æ•°å­¦è®¡ç®—ã€å¤©æ°”æŸ¥è¯¢ç­‰å¤šç§èƒ½åŠ›ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

### ğŸ¤– å¤šAgentåä½œæ¶æ„
- **æŸ¥è¯¢åˆ†è§£**ï¼šè‡ªåŠ¨è¯†åˆ«å¤åˆæŸ¥è¯¢ä¸­çš„å¤šç§æ„å›¾
- **å¹¶è¡Œæ‰§è¡Œ**ï¼šå¤šä¸ªå­æŸ¥è¯¢å¹¶è¡Œå¤„ç†ï¼Œæé«˜å“åº”é€Ÿåº¦
- **æ™ºèƒ½èšåˆ**ï¼šLLMé©±åŠ¨çš„ç»“æœæ•´åˆï¼Œç”Ÿæˆè¿è´¯å›ç­”

### ğŸ¯ æ™ºèƒ½è·¯ç”±ç³»ç»Ÿ
- **è‡ªåŠ¨æ•°æ®é›†é€‰æ‹©**ï¼šåŸºäºæŸ¥è¯¢å†…å®¹æ™ºèƒ½é€‰æ‹©æœ€åˆé€‚çš„æ•°æ®é›†
- **å¤šçº§å†³ç­–**ï¼šå…³é”®è¯åŒ¹é… â†’ LLMåˆ†ç±» â†’ é»˜è®¤ç­–ç•¥
- **é«˜æ€§èƒ½ä¼˜åŒ–**ï¼šé«˜ç½®ä¿¡åº¦æŸ¥è¯¢å¿«é€Ÿè¿”å›

### ğŸ› ï¸ å¤šå·¥å…·é›†æˆ
- **çŸ¥è¯†åº“æŸ¥è¯¢**ï¼šä»å‘é‡æ•°æ®åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯
- **æ•°å­¦è®¡ç®—**ï¼šæ”¯æŒåŠ æ³•ã€ä¹˜æ³•ç­‰æ•°å­¦è¿ç®—
- **å¤©æ°”æŸ¥è¯¢**ï¼šå®æ—¶å¤©æ°”ä¿¡æ¯è·å–
- **å¯æ‰©å±•è®¾è®¡**ï¼šæ˜“äºæ·»åŠ æ–°çš„å·¥å…·ç±»å‹

### ğŸ“Š æ”¯æŒçš„æ•°æ®é›†
- **æœºå™¨å­¦ä¹ è¯¾ç¨‹**ï¼šçº¦39ä¸‡å­—çš„æœºå™¨å­¦ä¹ è§†é¢‘è½¬å†™å†…å®¹
- **ä»·æ ¼æŒ‡æ•°ç»Ÿè®¡**ï¼šå›½å®¶ç»Ÿè®¡å±€13ä¸ªæœˆçš„ä»·æ ¼æŒ‡æ•°æ•°æ®

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API å±‚                               â”‚
â”‚              Hono REST API + äº¤äº’å¼æ–‡æ¡£                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åº”ç”¨å±‚                                  â”‚
â”‚               RAGApplication ç»Ÿä¸€å…¥å£                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¤šAgentåä½œå±‚                             â”‚
â”‚  QueryDecomposer â†’ SubAgentExecutor â†’ ResultAggregator     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ™ºèƒ½è·¯ç”±å±‚                                â”‚
â”‚             RouterEngine + LLMClassifier                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®è®¿é—®å±‚                                 â”‚
â”‚            VectorStoreService + Qdrant Cloud               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ config.ts                   # é…ç½®ç®¡ç†
â”œâ”€â”€ app.ts                      # åº”ç”¨ç¨‹åºä¸»å…¥å£
â”œâ”€â”€ index.ts                    # æœåŠ¡å™¨å¯åŠ¨å…¥å£
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ masterAgent.ts          # ä¸»æ§Agentï¼Œåè°ƒæ•´ä¸ªå¤„ç†æµç¨‹
â”‚   â”œâ”€â”€ queryDecomposer.ts      # æŸ¥è¯¢åˆ†è§£å™¨
â”‚   â”œâ”€â”€ subAgentExecutor.ts     # å­Agentæ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ resultAggregator.ts     # ç»“æœèšåˆå™¨
â”‚   â”œâ”€â”€ routerEngine.ts         # æ™ºèƒ½è·¯ç”±å¼•æ“
â”‚   â”œâ”€â”€ llmClassifier.ts        # LLMåˆ†ç±»å™¨
â”‚   â”œâ”€â”€ vectorStore.ts          # å‘é‡å­˜å‚¨æœåŠ¡
â”‚   â”œâ”€â”€ queryService.ts         # åŸºç¡€æŸ¥è¯¢æœåŠ¡
â”‚   â”œâ”€â”€ agentService.ts         # AgentæœåŠ¡
â”‚   â”œâ”€â”€ weatherService.ts       # å¤©æ°”æœåŠ¡
â”‚   â””â”€â”€ logger.ts               # æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ server.ts               # APIæœåŠ¡å™¨
â”‚   â””â”€â”€ docs.ts                 # APIæ–‡æ¡£
â””â”€â”€ tests/
    â””â”€â”€ vectorStore.test.ts     # æµ‹è¯•æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
OPENAI_API_KEY=your_openai_api_key
QDRANT_URL=your_qdrant_cloud_url
QDRANT_API_KEY=your_qdrant_api_key
WEATHER_API_KEY=your_weather_api_key  # å¯é€‰
PORT=3000
```

### 2. å®‰è£…ä¾èµ–

```bash
bun install
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨APIæœåŠ¡å™¨
bun run server

# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
bun run server:watch

# ç”Ÿäº§æ¨¡å¼
bun run server:prod
```

æœåŠ¡å¯åŠ¨åè®¿é—®ï¼š
- **APIæ–‡æ¡£**: http://localhost:3000
- **å¥åº·æ£€æŸ¥**: http://localhost:3000/health
- **åº”ç”¨çŠ¶æ€**: http://localhost:3000/status

## ğŸ“š ä½¿ç”¨æ–¹å¼

### REST API è°ƒç”¨

```bash
# å•ä¸€æ„å›¾æŸ¥è¯¢
curl -X POST http://localhost:3000/intelligent-query \
  -H "Content-Type: application/json" \
  -d '{"query": "ä»€ä¹ˆæ˜¯æ¢¯åº¦ä¸‹é™ï¼Ÿ"}'

# å¤šæ„å›¾å¤åˆæŸ¥è¯¢
curl -X POST http://localhost:3000/intelligent-query \
  -H "Content-Type: application/json" \
  -d '{"query": "æœ€è¿‘ä¸€ä¸ªæœˆPPIæ˜¯å¤šå°‘ï¼Ÿå¦å¤–è®¡ç®—123*456ï¼Œå†æŸ¥è¯¢åŒ—äº¬å¤©æ°”"}'

# æµå¼æŸ¥è¯¢
curl -X POST http://localhost:3000/intelligent-query/stream \
  -H "Content-Type: application/json" \
  -d '{"query": "è§£é‡Šä¸€ä¸‹æœºå™¨å­¦ä¹ ä¸­çš„è¿‡æ‹Ÿåˆ"}' \
  --no-buffer
```

### SDK ç›´æ¥è°ƒç”¨

```typescript
import { app } from './src/app';

// åˆå§‹åŒ–åº”ç”¨
await app.initialize();

// æ™ºèƒ½æŸ¥è¯¢
const result = await app.intelligentQuery('ä»€ä¹ˆæ˜¯æ¢¯åº¦ä¸‹é™ï¼Ÿ');
console.log(result.response);

// æµå¼æŸ¥è¯¢
for await (const chunk of app.intelligentQueryStream('è§£é‡Šæœºå™¨å­¦ä¹ æ¦‚å¿µ')) {
  process.stdout.write(chunk);
}

// è·¨æ•°æ®é›†æŸ¥è¯¢
const crossResult = await app.crossDatasetQuery('ç›¸å…³æŸ¥è¯¢', [
  'machine_learning', 
  'price_index_statistics'
]);
```

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®é›†é…ç½®
åœ¨ `src/config.ts` ä¸­ç®¡ç†æ•°æ®é›†ï¼š

```typescript
export const DATASET_CONFIGS = {
  machine_learning: {
    collectionName: 'machine_learning_documents',
    dataPath: './data/machine_learning_transcript',
    description: 'æœºå™¨å­¦ä¹ è¯¾ç¨‹å†…å®¹',
  },
  price_index_statistics: {
    collectionName: 'price_index_statistics',
    dataPath: './data/price_index_statistics_utf8',
    description: 'ä»·æ ¼æŒ‡æ•°ç»Ÿè®¡',
  },
};
```

### æ¨¡å‹é…ç½®
```typescript
export const OPENAI_CONFIG = {
  apiKey: process.env.OPENAI_API_KEY!,
  model: 'gpt-4o',
  temperature: 0,
  baseUrl: 'https://api.openai.com/v1',
};
```

## ğŸ¯ æŸ¥è¯¢ç¤ºä¾‹

### å•ä¸€æ„å›¾æŸ¥è¯¢
```json
{
  "query": "ä»€ä¹ˆæ˜¯æ¢¯åº¦ä¸‹é™ï¼Ÿ",
  "response": "æ¢¯åº¦ä¸‹é™æ˜¯ä¸€ç§ä¼˜åŒ–ç®—æ³•...",
  "analysis": {
    "queryType": "single_intent",
    "confidence": 0.9
  }
}
```

### å¤šæ„å›¾å¤åˆæŸ¥è¯¢
```json
{
  "query": "æœ€è¿‘ä¸€ä¸ªæœˆPPIæ˜¯å¤šå°‘ï¼Ÿå¦å¤–è®¡ç®—123*456ï¼Œå†æŸ¥è¯¢åŒ—äº¬å¤©æ°”",
  "response": "å…³äºæœ€è¿‘ä¸€ä¸ªæœˆçš„PPIæ•°æ®...",
  "decomposition": {
    "hasMultipleIntents": true,
    "subQueries": [
      {"type": "knowledge_query", "query": "æœ€è¿‘ä¸€ä¸ªæœˆPPIæ˜¯å¤šå°‘ï¼Ÿ"},
      {"type": "math_calculation", "query": "è®¡ç®—123*456"},
      {"type": "weather_query", "query": "æŸ¥è¯¢åŒ—äº¬å¤©æ°”"}
    ]
  },
  "executionSummary": {
    "totalSubQueries": 3,
    "successfulQueries": 3,
    "failedQueries": 0,
    "totalExecutionTime": 2500
  }
}
```

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œå‘é‡å­˜å‚¨æµ‹è¯•
bun run test:vectorstore

# è¿è¡ŒAPIæµ‹è¯•
bun run test:api
```

## ğŸ“ˆ æ€§èƒ½ç‰¹ç‚¹

- **å“åº”æ—¶é—´**ï¼šå•ä¸€æŸ¥è¯¢ 2-5ç§’ï¼Œå¤åˆæŸ¥è¯¢ 5-15ç§’
- **å¹¶å‘æ”¯æŒ**ï¼šæ”¯æŒå¤šä¸ªå¹¶å‘è¯·æ±‚
- **æµå¼å“åº”**ï¼šå®æ—¶è¾“å‡ºï¼Œé¦–å­—èŠ‚æ—¶é—´ <1ç§’
- **æ™ºèƒ½ç¼“å­˜**ï¼šæé«˜é‡å¤æŸ¥è¯¢å“åº”é€Ÿåº¦

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**ï¼šBun (JavaScriptè¿è¡Œæ—¶å’ŒåŒ…ç®¡ç†å™¨)
- **è¯­è¨€**ï¼šTypeScript (ç±»å‹å®‰å…¨)
- **RAGæ¡†æ¶**ï¼šLlamaIndex.TS
- **å‘é‡æ•°æ®åº“**ï¼šQdrant Cloud
- **LLMæœåŠ¡**ï¼šOpenAI GPT-4o
- **åµŒå…¥æ¨¡å‹**ï¼šOpenAI text-embedding-3-small
- **APIæ¡†æ¶**ï¼šHono (è½»é‡çº§Webæ¡†æ¶)
- **å¤–éƒ¨API**ï¼šWeatherAPI (å¤©æ°”æœåŠ¡)

## ğŸ” API æ¥å£

### æ ¸å¿ƒæ¥å£
- `POST /intelligent-query` - æ™ºèƒ½æŸ¥è¯¢
- `POST /intelligent-query/stream` - æµå¼æ™ºèƒ½æŸ¥è¯¢
- `POST /cross-query` - è·¨æ•°æ®é›†æŸ¥è¯¢

### ç®¡ç†æ¥å£
- `GET /health` - å¥åº·æ£€æŸ¥
- `GET /status` - åº”ç”¨çŠ¶æ€
- `GET /datasets` - æ•°æ®é›†åˆ—è¡¨
- `POST /rebuild` - é‡å»ºç´¢å¼•
- `DELETE /collection` - åˆ é™¤æ•°æ®é›†

## ğŸ åŠŸèƒ½äº®ç‚¹

- **ğŸ§  æ™ºèƒ½åˆ†è§£**ï¼šè‡ªåŠ¨è¯†åˆ«å¤åˆæŸ¥è¯¢ä¸­çš„å¤šç§æ„å›¾
- **âš¡ å¹¶è¡Œå¤„ç†**ï¼šå¤šä¸ªå­æŸ¥è¯¢åŒæ—¶æ‰§è¡Œï¼Œæé«˜æ•ˆç‡
- **ğŸ¯ ç²¾å‡†è·¯ç”±**ï¼šæ™ºèƒ½é€‰æ‹©æœ€åˆé€‚çš„æ•°æ®é›†
- **ğŸ”„ æµå¼å“åº”**ï¼šå®æ—¶è¾“å‡ºï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **ğŸ›¡ï¸ é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œé™çº§æœºåˆ¶
- **ğŸ“Š æ‰§è¡Œç»Ÿè®¡**ï¼šè¯¦ç»†çš„æ€§èƒ½å’Œæ‰§è¡Œç»Ÿè®¡ä¿¡æ¯

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„æ•°æ®é›†
1. åœ¨ `src/config.ts` ä¸­æ·»åŠ æ•°æ®é›†é…ç½®
2. åœ¨ `src/services/llmClassifier.ts` ä¸­æ·»åŠ æè¿°
3. é‡å»ºç´¢å¼•å³å¯ä½¿ç”¨

### æ·»åŠ æ–°çš„å·¥å…·ç±»å‹
1. åœ¨ `src/services/subAgentExecutor.ts` ä¸­æ·»åŠ æ‰§è¡Œé€»è¾‘
2. åœ¨ `src/services/queryDecomposer.ts` ä¸­æ·»åŠ ç±»å‹è¯†åˆ«
3. æ›´æ–°ç›¸å…³TypeScriptç±»å‹å®šä¹‰

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## å‘
ä¸è¦ä½¿ç”¨openrouterã€‚openrouterï¼š
- ä¸æ”¯æŒ embedding modelï¼Œå³æ— æ³•åˆ›å»º vector store
- ä¸æ”¯æŒ tool callingï¼Œå³ä½¿ä½¿ç”¨ gpt-4o